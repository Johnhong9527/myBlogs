# 使用 FFmpeg 转换媒体文件的快速指南(转)

[原文](https://opensource.com/article/17/6/ffmpeg-convert-media-file-formats)

> FFmpeg 是用于快速更改 AV 文件的格式或质量，提取音频，创建 GIF 等的出色工具。

![images/ffmpeg/2020-01-26](/images/ffmpeg/2020-01-26/arrows_translation_lead.jpg)

_图片学分：Jen Wike Huger 摄_

有许多开源工具可用于编辑，调整和将多媒体准确地转换为您所需的内容。诸如 [Audacity](https://www.audacityteam.org/) 或 [Handbrake](https://handbrake.fr/) 之类的工具非常出色，但是有时您只想快速将文件从一种格式更改为另一种格式。输入 FFmpeg。

FFmpeg 是处理多媒体文件的不同项目的集合。在许多其他与媒体相关的项目中，它经常在幕后使用。尽管它的名字，它与[运动图像专家组](https://en.wikipedia.org/wiki/Moving_Picture_Experts_Group)或它创建的各种多媒体格式无关。

在本文中，我将通过命令行工具 ffmpeg 使用 FFmpeg ，这只是 FFmpeg 项目的一个很小的部分。它在许多不同的操作系统上都可用，并且默认情况下包含在某些操作系统中。可以从 [FFmpeg](https://ffmpeg.org/) 网站或大多数软件包管理器中下载。

FFmpeg 是一个功能强大的工具，几乎可以完成多媒体文件中您可以想象的任何事情。在本文中，我们有兴趣使用它来转换文件，因此我们不会深入研究其整个功能集。在考虑使用 FFmpeg 之前，首先我们需要快速了解媒体文件的确切含义。

## 媒体文件

在非常高的层次上，媒体文件被分解为一个容器及其流。这些流包括实际的 AV 组件，例如电影的音频或视频，并使用特定的媒体编码或[编解码器进行编码](https://en.wikipedia.org/wiki/Codec)。每个编解码器都有自己的属性，优点和缺点。例如，[FLAC 编解码器](https://en.wikipedia.org/wiki/FLAC)适用于高质量无损音频，而 [Vorbis](https://en.wikipedia.org/wiki/Vorbis) 旨在与 MP3 竞争文件大小，同时提供更好的音频质量。这意味着 FLAC 格式的文件将比 Vorbis 音频流大得多，但听起来应该更好。两者在本质上都不比另一个更好，因为每个人都在尝试做不同的事情。

容器是流的包装。它提供了媒体播放器和工具可以交互的单个界面。一些容器非常先进，并允许任何类型的流，包括单个容器内的多个视频和音频流。容器中的流不必只是音频或视频。不同的容器将允许不同的流，例如字幕，章节信息或其他元数据。这完全取决于容器设置为允许的范围。

这是媒体文件的抽象表示，并且跳过了容器之间的许多差异。许多要求某些流和元数据，或者对所允许的编解码器或内容施加限制。这种解释足以使您理解本文。要了解更多信息，请单击上面的链接。

请注意，视频和音频编码可能需要很长时间才能运行。使用 FFmpeg 时，您应该准备好适应一段时间。

## 基本转换

在转换音频和视频时，令大多数人震惊的是选择正确的格式和容器。幸运的是，FFmpeg 的默认设置非常聪明。通常，它会自动选择正确的编解码器和容器，而无需进行任何复杂的配置。

例如，假设您有一个 MP3 文件，并希望将其转换为 OGG 文件：

```
ffmpeg -i input.mp3 output.ogg
```

此命令获取一个名为`input.mp3`的 MP3 文件，并将其转换为一个名为 `output.ogg` 的 OGG 文件。从 FFmpeg 的角度来看，这意味着将 MP3 音频流转换为 Vorbis 音频流并将其包装到 OGG 容器中。您不必指定流或容器类型，因为 FFmpeg 会为您解决。

这也适用于视频：

```
ffmpeg -i input.mp4 output.webm
```

由于 [WebM](https://www.webmproject.org/) 是一种定义明确的格式，因此 FFmpeg 会自动知道它可以支持的视频和音频，并将流转换为有效的 [WebM](https://en.wikipedia.org/wiki/WebM) 文件。

根据您选择的容器，此方法并非总是有效。例如，诸如[Matroska](https://matroska.org/)之类的容器旨在处理您关心放入其中的几乎所有流，无论它们是否有效。这意味着命令：

```
ffmpeg -i input.mp4 output.mkv
```

可能会导致文件具有与`input.mp4`相同的编解码器，可能不是您想要的文件。

## 选择编解码器

因此，当您想使用 Matroska 这样的容器（可以处理几乎所有流）但又影响输出中的编解码器时，该怎么办？FFmpeg 进行救援！您可以使用-c 标志来选择所需的编解码器。

此标志使您可以设置要用于每个流的不同编解码器。例如，要将音频流设置为 Vorbis，可以使用以下命令：

```
ffmpeg -i input.mp3 -c:a libvorbis output.ogg
```

可以更改视频和音频流的方法相同：

```
ffmpeg -i input.mp4 -c:v vp9 -c:a libvorbis output.mkv
```

这将使 Matroska 容器具有[VP9](https://en.wikipedia.org/wiki/VP9)视频流和 Vorbis 音频流，与我们之前制作的 WebM 基本相同。

`ffmpeg -codecs`命令将打印 FFmpeg 知道的每个编解码器。该命令的输出将根据您安装的 FFmpeg 的版本而变化。

## 更改单个流

您所拥有的文件经常会以不正确的格式（仅单个流）部分地正确存储。重新编码正确的流可能非常耗时。FFmpeg 可以帮助解决这种情况：

```
ffmpeg -i input.webm -c:v copy -c:a flac output.mkv
```

此命令将视频流从`input.webm`复制到`output.mkv`，并将 Vorbis 音频流编码为 FLAC。该`-c`标志是真的很强大。

## 更换容器

前面的示例可以应用于音频和视频流，从而使您可以从一种容器格式转换为另一种容器格式，而无需执行任何其他流编码：

```
ffmpeg -i input.webm -c:av copy output.mkv
```

## 影响质量

现在我们有了编解码器的句柄，下一个问题是：我们如何设置每个流的质量？

最简单的方法是更改 ​​ 比特率，这可能会或可能不会导致不同的质量。人类的视听能力并不像我们想的那么清晰。有时更改比特率会对主观质量产生巨大影响。其他时候，它可能什么也没做，只是更改文件大小。有时，很难尝试一下就很难知道会发生什么。

要设置每个流的比特率，请使用 `-b` 标志，该标志的工作方式与 `-c` 标志类似，只是您设置了比特率而不是编解码器选项。

例如，要更改视频的比特率，可以这样使用：

```
ffmpeg -i input.webm -c:a copy -c:v vp9 -b:v 1M output.mkv
```

这将从`input.webm`复制音频（`-c:a copy`）并将视频转换为比特率为 1M/s（`-b:v`）的 VP9 编解码器（`-c:v vp9`），所有捆绑在一个 Matroska 容器（`output.mkv`）。

影响质量的另一种方法是使用-r 选项调整视频的帧频：

```
ffmpeg -i input.webm -c:a copy -c:v vp9 -r 30 output.mkv
```

这将创建一个新的 Matroska，并复制音频流，并将视频流的帧速率强制为每秒 30 帧，而不是使用输入的帧速率（`-r 30`）。

您还可以使用 FFmpeg 调整视频的尺寸。最简单的方法是使用预定的视频大小：

```
ffmpeg -i input.mkv -c:a copy -s hd720 output.mkv
```

这会将视频在输出中修改为 1280x720，但是您可以根据需要手动设置宽度和高度：

```
ffmpeg -i input.mkv -c:a copy -s 1280x720 output.mkv
```

这将产生与先前命令完全相同的输出。如果要在 FFmpeg 中设置自定义尺寸，请记住，width 参数（`1280`）位于高度（`720`）之前。

调整帧速率和比特率是影响媒体质量的两种粗糙但有效的技术。如果这些值的质量已经很低，则将它们设置得很高将无法提高其质量。

更改这些设置对于快速减少高质量流以减小文件大小最有效。调整视频的大小并不能提高质量，但是可以使其更适合平板电脑而不是电视。将 640x480 视频的大小更改为 4K 不会改善它。

更改文件的质量是非常主观的事情，这意味着没有一种可以每次使用的方法。最好的方法是进行一些更改，并测试它对您来说看起来还是听起来更好。

## 修改流

通常，您的文件几乎是完美的，只需要修剪掉几部分即可。使用显示您所更改内容的工具可以更轻松地完成此操作，但是如果您确切知道要修剪的位置，则在 FFmpeg 中非常容易做到：

```
ffmpeg -i input.mkv -c:av copy -ss 00:01:00 -t 10 output.mkv
```

这将复制视频和音频流（`-c:av copy`），但会修剪视频。的-t 选项集切割持续时间为 10 秒，`-ss`选项设置视频的开始点在一分钟（修边，在这种情况下`00:01:00`）。您不仅可以精确到几小时，几分钟和几秒钟，还可以精确到毫秒（如果需要）。

## 提取音频

有时您并不真正在乎视频，而只是想要音频。幸运的是，这在带有`-vn`标志的 FFmpeg 中非常简单：

```
ffmpeg -i input.mkv -vn audio_only.ogg
```

此命令仅从输入中提取音频，将其编码为 Vorbis，然后将其保存到 `audio_only.ogg` 中。现在您有了隔离的音频流。您还可以以相同方式使用 `-an` 和 `-sn` 标志来去除音频和字幕流。

## 用它制作 GIF

最近，动画 GIF（因为我不是怪物所以用硬 g 表示）卷土重来。我个人认为 GIF 是您可以选择的最差的视频格式。它具有可怕的压缩质量和大小；在颜色，帧速率和容器元数据方面有非常严格的限制；并且不支持音频。尽管如此，它还是很受欢迎。那么，如何将视频剪辑制作成动画 GIF？

如果您想制作不带音频的视频，则使用 `-an` 标志（类似于我们上面的操作）比创建动画 GIF 更好，但是有很多地方支持不支持其他视频格式的 GIF 。对于所有这些：

```
ffmpeg -i input.mkv output.gif
```

此命令创建与输入文件相同尺寸的 GIF。这通常是个坏主意，因为 GIF 相对于其他视频格式的压缩效果不佳（以我的经验，GIF 的大小约为源视频的八倍）。使用-s 选项将 GIF 调整为较小的尺寸可能会有所帮助，尤其是在输入源非常大的情况下，例如高清视频。

## 其他工具

尽管 FFmpeg 是大多数 AV 任务的必备工具，但它并非对所有事物而言都是完美的。有一些工具与 FFmpeg 结合使用，可以使一切变得简单一些。

### 从 YouTube 抓取视频

将某些内容上传到 YouTube，丢失原始源视频并仅保留 YouTube 版本非常容易。检索 YouTube 视频副本的最简单方法是什么？

`Youtube-dl`是一个漂亮的小工具，可用于从 YouTube 和其他一些视频流服务中获取视频。使用起来超级简单：

```
youtube-dl https://www.youtube.com/watch?v=2m5nW9CQLJ0
```

此命令通过指定的 URL 下载视频并将其保存在本地。

Youtube-dl 有几个选项可以控制下载视频的质量和格式，但是我发现使用上面的命令更容易。它将最高质量的音频和视频下载到一个文件中，然后使用 FFmpeg 将它们转换为所需的格式。

### 获取有关媒体的信息

有时，您只需要知道媒体容器中的内容即可。尽管有几种工具可以做到这一点，但我首选的是 [MediaInfo](https://mediaarea.net/en/MediaInfo)。MediaInfo 显示媒体容器内每个不同流的所有信息，以及输入文件的元数据。这为您提供了您可能想知道的所有信息，并且可能提供了许多您不想要的东西。

运行命令`mediainfo inputFile.mkv`以人类可读的形式显示有关输入文件的信息列表。

## 更多

这仅仅是 FFmpeg 可以做的事情的表面。幸运的是，FFmpeg 的[文档](http://ffmpeg.org/documentation.html)和该项目的其他工具非常好，值得一看。它会教您有关这只狗可以做的许多不同技巧的所有事情。

如果您想使用带有用于转换多媒体的图形界面的工具，那么 [Handbrake](https://handbrake.fr/) 是在 Linux，Mac OS X 和 Windows 上非常出色的工具。手刹在引擎盖下使用 FFmpeg（以及其他工具）。
